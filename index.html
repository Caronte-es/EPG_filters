
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>EPG dobleM</title>
  <style>
    /* General Page Styles */
    body {
      font-family: Arial, sans-serif;
      background-color: #222;
      color: white;
      padding: 15px;
    }

    /* Input Fields */
    label {
      margin-right: 5px;
    }

    input[type="file"],
    input[type="text"] {
      margin: 5px 0;
      padding: 5px;
    }

    /* Table Styles */
    table {
      border-collapse: collapse;
      width: 100%;
      background-color: black;
      color: white;
      margin: 10px 0;
    }

    th, td {
      border: 1px solid white;
      padding: 8px;
      text-align: left;
      font-size: 14px;
    }

    th {
      background-color: #555;
    }

    tr:nth-child(even) {
      background-color: #333;
    }

    /* Buttons for Pagination */
    button {
      background-color: #555;
      color: white;
      padding: 10px;
      border: none;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background-color: #777;
    }
  </style>
<style type="text/css">
.grande { font-size: 60px; }
</style>
<script>
// Escribir aqui el código Javascript
</script>
</head>
<body>

  <h1>EPG dobleM</h1>

  <!-- File Selector -->
  <div>
    <label for="fileInput">Selecciona archivo XMLTV:</label>
    <input type="file" id="fileInput" accept=".xml">
  </div>

  <!-- Filtering Inputs -->
  <div>
    <label>Filtro por Canal:</label>
    <input type="text" id="filterChannel" oninput="applyFilters()">

    <label>Filtro por Título:</label>
    <input type="text" id="filterTitle" oninput="applyFilters()">

    <label>Filtro por Descripciónn:</label>
    <input type="text" id="filterDescription" oninput="applyFilters()">
  </div>

  <!-- Table for displaying data -->
  <table>
    <thead>
      <tr>
        <th>Canal</th>
        <th>Inicio</th>
        <th>Fin</th>
        <th>Imagen</th>
        <th>Título</th>
        <th>Descripción</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Dynamically populated table rows -->
    </tbody>
  </table>

  <!-- Pagination Controls -->
  <div>
    <button onclick="prevPage()">Anterior</button>
    <button onclick="nextPage()">Siguiente</button>
  </div>

<script>
let data = [];
let currentPage = 0;
const rowsPerPage = 100;

// Handle file selection
document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(event) {
      parseXMLTV(event.target.result);
    };
    reader.readAsText(file);
  }
});

// Parse the XMLTV file
function parseXMLTV(xmlString) {
  const parser = new DOMParser();
  const xmlDoc = parser.parseFromString(xmlString, 'application/xml');
  const programmes = xmlDoc.getElementsByTagName('programme');

  data = [];
  
  for (let i = 0; i < programmes.length; i++) {
    const channel = programmes[i].getAttribute('channel') || '';
    const start = programmes[i].getAttribute('start') || '';
    const stop = programmes[i].getAttribute('stop') || '';
    const title = programmes[i].getElementsByTagName('title')[0]?.textContent || '';
    const description = programmes[i].getElementsByTagName('desc')[0]?.textContent || '';
    const icon = programmes[i].getElementsByTagName('icon')[0]?.getAttribute('src') || '';

    data.push({
      channel,
      start: formatDate(start),
      stop: formatDate(stop),
      title,
      description,
      icon,
    });
  }

  currentPage = 0;
  displayPage();
}

// Format date from the XML date format (YYYYMMDDHHMMSS)
function formatDate(datetimeString) {
  if (!datetimeString) return '';
  const date = new Date(
    parseInt(datetimeString.substring(0, 4)), // Year
    parseInt(datetimeString.substring(4, 6)) - 1, // Month
    parseInt(datetimeString.substring(6, 8)), // Date
    parseInt(datetimeString.substring(8, 10)), // Hour
    parseInt(datetimeString.substring(10, 12)), // Minute
    parseInt(datetimeString.substring(12, 14)) // Second
  );
  if (isNaN(date.getTime())) return '';
  const dd = String(date.getDate()).padStart(2, '0');
  const mm = String(date.getMonth() + 1).padStart(2, '0');
  const yyyy = date.getFullYear();
  const hh = String(date.getHours()).padStart(2, '0');
  const min = String(date.getMinutes()).padStart(2, '0');
  return `${dd}/${mm}/${yyyy} ${hh}:${min}`;
}

// Filter logic
function applyFilters() {
  currentPage = 0;
  displayPage();
}

// Filter data based on input fields
function filterData() {
  const filterChannel = document.getElementById('filterChannel').value.toLowerCase();
  const filterTitle = document.getElementById('filterTitle').value.toLowerCase();
  const filterDescription = document.getElementById('filterDescription').value.toLowerCase();

  return data.filter(item =>
    item.channel.toLowerCase().includes(filterChannel) &&
    item.title.toLowerCase().includes(filterTitle) &&
    item.description.toLowerCase().includes(filterDescription)
  );
}

// Display current page with data
function displayPage() {
  const tableBody = document.getElementById('tableBody');
  tableBody.innerHTML = '';

  const filteredData = filterData();
  const startIndex = currentPage * rowsPerPage;
  const endIndex = Math.min(startIndex + rowsPerPage, filteredData.length);

  for (let i = startIndex; i < endIndex; i++) {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${filteredData[i].channel}</td>
      <td>${filteredData[i].start}</td>
      <td>${filteredData[i].stop}</td>
      <td><img src="${filteredData[i].icon}" alt="Icon" style="width: 100px; height: auto;"></td>
      <td>${filteredData[i].title}</td>
      <td>${filteredData[i].description}</td>
    `;
    tableBody.appendChild(row);
  }
}

// Handle next page
function nextPage() {
  const filteredData = filterData();
  if ((currentPage + 1) * rowsPerPage < filteredData.length) {
    currentPage++;
    displayPage();
  }
}

// Handle previous page
function prevPage() {
  if (currentPage > 0) {
    currentPage--;
    displayPage();
  }
}
</script>



</body></html>
